# ğŸš€ í†µí•© ì„œë²„ ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
2. [íŒŒì¼ êµ¬ì¡°](#íŒŒì¼-êµ¬ì¡°)
3. [ì„¤ì • íŒŒì¼ë“¤](#ì„¤ì •-íŒŒì¼ë“¤)
4. [ë°°í¬ ë‹¨ê³„](#ë°°í¬-ë‹¨ê³„)
5. [í…ŒìŠ¤íŠ¸ ë°©ë²•](#í…ŒìŠ¤íŠ¸-ë°©ë²•)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### í†µí•© ì„œë²„ êµ¬ì¡°
```
í†µí•© Docker ì»¨í…Œì´ë„ˆ (Cloud Run)
â”œâ”€â”€ ğŸ“± React í´ë¼ì´ì–¸íŠ¸ â†’ ğŸ”— FastAPI (Port 8080) â† ì™¸ë¶€ ì ‘ê·¼
â”œâ”€â”€ ğŸ FastAPI ì„œë²„ (Port 8081) â† ë‚´ë¶€ ì„œë¹„ìŠ¤
â”œâ”€â”€ ğŸŸ¢ Firebase MCP ì„œë²„ (Port 3000) â† ë‚´ë¶€ ì„œë¹„ìŠ¤
â””â”€â”€ ğŸ”„ Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ â† ë¼ìš°íŒ… ê´€ë¦¬
```

### í†µì‹  íë¦„
```
ì‚¬ìš©ì ìš”ì²­ â†’ Nginx (8080) â†’ FastAPI (8081) â†’ Firebase MCP (3000) â†’ Firebase
```

### í•µì‹¬ ì›ì¹™
- âœ… **ê¸°ì¡´ ì½”ë“œ êµ¬ì¡° 100% ë³´ì¡´**
- âœ… **ë‚´ë¶€ í†µì‹ ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”**
- âœ… **ë‹¨ì¼ ì»¨í…Œì´ë„ˆë¡œ ìš´ì˜ ë‹¨ìˆœí™”**

---

## ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
interior-agent/
â”œâ”€â”€ ğŸ“ firebase-mcp/                    # Firebase MCP ì„œë²„ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ interior-one-click-firebase-adminsdk-mpr08-94f76b4e50.json
â”œâ”€â”€ ğŸ“ interior_multi_agent/            # ADK ì—ì´ì „íŠ¸ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
â”‚   â””â”€â”€ interior_agents/
â”œâ”€â”€ ğŸ“ mobile_chatbot/                  # React ì•± (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
â”‚   â””â”€â”€ src/
â”œâ”€â”€ ğŸ simple_api_server.py             # FastAPI ì„œë²„ (URL 1ì¤„ ìˆ˜ì •)
â”œâ”€â”€ ğŸ“‹ requirements_fastapi.txt         # Python ì˜ì¡´ì„±
â”œâ”€â”€ ğŸ³ Dockerfile.integrated            # í†µí•© Docker ì„¤ì •
â”œâ”€â”€ âš™ï¸ supervisord.conf                 # ë©€í‹° í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬
â”œâ”€â”€ ğŸ”„ nginx.conf                       # ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
â””â”€â”€ ğŸ“š í†µí•©_ì„œë²„_ë°°í¬_ê°€ì´ë“œ.md          # ì´ ë¬¸ì„œ
```

---

## âš™ï¸ ì„¤ì • íŒŒì¼ë“¤

### 1. Dockerfile.integrated
```dockerfile
# Firebase MCP ë¹Œë“œ ìŠ¤í…Œì´ì§€
FROM node:lts-alpine AS mcp-builder
WORKDIR /app/mcp
COPY firebase-mcp/package*.json ./
RUN npm install --ignore-scripts
COPY firebase-mcp/ ./
RUN npm run build

# FastAPI ë¹Œë“œ ìŠ¤í…Œì´ì§€  
FROM python:3.11-slim AS fastapi-builder
WORKDIR /app/api
COPY requirements_fastapi.txt .
RUN pip install -r requirements_fastapi.txt

# ìµœì¢… í†µí•© ìŠ¤í…Œì´ì§€
FROM python:3.11-slim
WORKDIR /app

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    nodejs npm nginx supervisor curl \
    && rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„± ì„¤ì¹˜
COPY requirements_fastapi.txt .
RUN pip install -r requirements_fastapi.txt

# Firebase MCP ë³µì‚¬
COPY --from=mcp-builder /app/mcp/dist ./mcp/dist
COPY --from=mcp-builder /app/mcp/package.json ./mcp/
COPY --from=mcp-builder /app/mcp/node_modules ./mcp/node_modules
COPY firebase-mcp/interior-one-click-firebase-adminsdk-mpr08-94f76b4e50.json ./mcp/

# FastAPI ë° ê´€ë ¨ íŒŒì¼ ë³µì‚¬
COPY simple_api_server.py .
COPY interior_multi_agent/ ./interior_multi_agent/
COPY .env* ./

# ì„¤ì • íŒŒì¼ ë³µì‚¬
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
COPY nginx.conf /etc/nginx/nginx.conf

# ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
RUN mkdir -p /var/log/supervisor

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# í—¬ìŠ¤ì²´í¬ ì¶”ê°€
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1

# Supervisorë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
```

### 2. supervisord.conf
```ini
[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# Firebase MCP ì„œë²„
[program:mcp-server]
command=node dist/index.js
directory=/app/mcp
environment=PORT=3000,MCP_TRANSPORT=http,SERVICE_ACCOUNT_KEY_PATH=/app/mcp/interior-one-click-firebase-adminsdk-mpr08-94f76b4e50.json,FIREBASE_STORAGE_BUCKET=interior-one-click.firebasestorage.app
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/mcp-server.err.log
stdout_logfile=/var/log/mcp-server.out.log
stderr_logfile_maxbytes=10MB
stdout_logfile_maxbytes=10MB

# FastAPI ì„œë²„
[program:fastapi-server]
command=uvicorn simple_api_server:app --host 0.0.0.0 --port 8081 --workers 1
directory=/app
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/fastapi-server.err.log
stdout_logfile=/var/log/fastapi-server.out.log
stderr_logfile_maxbytes=10MB
stdout_logfile_maxbytes=10MB

# Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/nginx.err.log
stdout_logfile=/var/log/nginx.out.log
stderr_logfile_maxbytes=10MB
stdout_logfile_maxbytes=10MB
```

### 3. nginx.conf
```nginx
events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # ë¡œê·¸ ì„¤ì •
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
    
    # ì—…ìŠ¤íŠ¸ë¦¼ ì„œë²„ ì •ì˜
    upstream fastapi {
        server localhost:8081;
    }
    
    upstream mcp {
        server localhost:3000;
    }

    server {
        listen 8080;
        server_name _;
        
        # í´ë¼ì´ì–¸íŠ¸ ìµœëŒ€ ì—…ë¡œë“œ í¬ê¸°
        client_max_body_size 10M;
        
        # íƒ€ì„ì•„ì›ƒ ì„¤ì •
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ë©”ì¸ FastAPI ì—”ë“œí¬ì¸íŠ¸
        location / {
            proxy_pass http://fastapi;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # Firebase MCP ì§ì ‘ ì ‘ê·¼ (ë””ë²„ê¹…ìš©)
        location /mcp {
            proxy_pass http://mcp;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
        location /nginx-health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
```

### 4. simple_api_server.py ìˆ˜ì •ì‚¬í•­
```python
# ê¸°ì¡´ ì½”ë“œì—ì„œ ë‹¨ í•œ ì¤„ë§Œ ë³€ê²½
# ê¸°ì¡´
FIREBASE_MCP_URL = "https://firebase-mcp-638331849453.asia-northeast3.run.app/mcp"

# ë³€ê²½ í›„
FIREBASE_MCP_URL = "http://localhost:3000/mcp"

# ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ì™„ì „íˆ ë™ì¼í•˜ê²Œ ìœ ì§€!
```

---

## ğŸš€ ë°°í¬ ë‹¨ê³„

### 1ï¸âƒ£ ì¤€ë¹„ ë‹¨ê³„
```bash
# 1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd interior-agent

# 2. í•„ìš”í•œ íŒŒì¼ë“¤ì´ ìˆëŠ”ì§€ í™•ì¸
ls -la
# í™•ì¸í•  íŒŒì¼ë“¤:
# - firebase-mcp/
# - interior_multi_agent/
# - mobile_chatbot/
# - simple_api_server.py
# - requirements_fastapi.txt
```

### 2ï¸âƒ£ Firebase MCP ë¹Œë“œ ì¤€ë¹„
```bash
# Firebase MCP ì„œë²„ ë¹Œë“œ
cd firebase-mcp
npm install
npm run build
cd ..
```

### 3ï¸âƒ£ ì„¤ì • íŒŒì¼ ìƒì„±
```bash
# ìœ„ì—ì„œ ì œê³µí•œ ë‚´ìš©ìœ¼ë¡œ íŒŒì¼ë“¤ ìƒì„±
# - Dockerfile.integrated
# - supervisord.conf  
# - nginx.conf
```

### 4ï¸âƒ£ ë¡œì»¬ í…ŒìŠ¤íŠ¸
```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build -f Dockerfile.integrated -t interior-integrated .

# ë¡œì»¬ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
docker run -p 8080:8080 interior-integrated

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸
curl http://localhost:8080/health
```

### 5ï¸âƒ£ Cloud Run ë°°í¬
```bash
# Google Cloud í”„ë¡œì íŠ¸ ì„¤ì •
gcloud config set project YOUR_PROJECT_ID

# ë¦¬ì „ ì„¤ì •
gcloud config set run/region asia-northeast3

# Cloud Run ë°°í¬
gcloud run deploy interior-integrated \
  --source . \
  --dockerfile Dockerfile.integrated \
  --allow-unauthenticated \
  --memory 2Gi \
  --cpu 2 \
  --timeout 300 \
  --concurrency 80 \
  --max-instances 10 \
  --region asia-northeast3
```

### 6ï¸âƒ£ í™˜ê²½ë³€ìˆ˜ ì„¤ì • (í•„ìš”ì‹œ)
```bash
# Google API Key ì„¤ì •
gcloud run services update interior-integrated \
  --update-env-vars GOOGLE_API_KEY=YOUR_API_KEY \
  --region asia-northeast3
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1ï¸âƒ£ í—¬ìŠ¤ì²´í¬ í…ŒìŠ¤íŠ¸
```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
curl https://YOUR_SERVICE_URL/health

# ì˜ˆìƒ ì‘ë‹µ:
{
  "status": "healthy",
  "firebase_connected": true,
  "timestamp": "2024-01-01T00:00:00"
}
```

### 2ï¸âƒ£ ì±„íŒ… API í…ŒìŠ¤íŠ¸
```bash
curl -X POST https://YOUR_SERVICE_URL/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”"}'
```

### 3ï¸âƒ£ Firebase ë„êµ¬ í…ŒìŠ¤íŠ¸
```bash
curl -X POST https://YOUR_SERVICE_URL/firebase/tool \
  -H "Content-Type: application/json" \
  -d '{"tool_name": "firestore_list_collections", "arguments": {"random_string": "test"}}'
```

### 4ï¸âƒ£ React ì•± ì—°ê²° í…ŒìŠ¤íŠ¸
```javascript
// mobile_chatbot/src/Chat.jsì—ì„œ API URL ìˆ˜ì •
const API_BASE_URL = "https://YOUR_SERVICE_URL";
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ
```bash
# ë¡œê·¸ í™•ì¸
gcloud run services describe interior-integrated --region asia-northeast3
gcloud logs read --service interior-integrated --region asia-northeast3
```

### ë¬¸ì œ 2: Firebase MCP ì—°ê²° ì‹¤íŒ¨
```bash
# MCP ì„œë²„ ë¡œê·¸ í™•ì¸
docker logs CONTAINER_ID 2>&1 | grep mcp-server
```

### ë¬¸ì œ 3: ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# ë©”ëª¨ë¦¬ ëŠ˜ë¦¬ê¸°
gcloud run services update interior-integrated \
  --memory 4Gi \
  --region asia-northeast3
```

### ë¬¸ì œ 4: íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜
```bash
# íƒ€ì„ì•„ì›ƒ ëŠ˜ë¦¬ê¸°
gcloud run services update interior-integrated \
  --timeout 600 \
  --region asia-northeast3
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### Cloud Run ë©”íŠ¸ë¦­ í™•ì¸
- CPU ì‚¬ìš©ë¥ 
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
- ìš”ì²­ ì§€ì—°ì‹œê°„
- ì—ëŸ¬ìœ¨

### ë¡œê·¸ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
gcloud logs tail --service interior-integrated --region asia-northeast3
```

---

## ğŸ”„ ì—…ë°ì´íŠ¸ ë°°í¬

### ì½”ë“œ ë³€ê²½ í›„ ì¬ë°°í¬
```bash
# 1. ì½”ë“œ ìˆ˜ì •
# 2. ì¬ë°°í¬
gcloud run deploy interior-integrated \
  --source . \
  --dockerfile Dockerfile.integrated \
  --region asia-northeast3
```

### ë¡¤ë°± (í•„ìš”ì‹œ)
```bash
# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
gcloud run services update-traffic interior-integrated \
  --to-revisions PREVIOUS_REVISION=100 \
  --region asia-northeast3
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Firebase MCP ì„œë²„ ë¹Œë“œ ì™„ë£Œ
- [ ] ëª¨ë“  ì„¤ì • íŒŒì¼ ìƒì„± ì™„ë£Œ
- [ ] simple_api_server.py URL ìˆ˜ì • ì™„ë£Œ
- [ ] ë¡œì»¬ Docker í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] Google Cloud í”„ë¡œì íŠ¸ ì„¤ì • ì™„ë£Œ

### ë°°í¬ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Cloud Run ì„œë¹„ìŠ¤ ì •ìƒ ì‹¤í–‰
- [ ] í—¬ìŠ¤ì²´í¬ API ì‘ë‹µ í™•ì¸
- [ ] ì±„íŒ… API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] Firebase ì—°ê²° ìƒíƒœ ì •ìƒ
- [ ] React ì•± ì—°ë™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **ì„±ëŠ¥ ìµœì í™”**: ìºì‹±, ì—°ê²° í’€ë§
2. **ë³´ì•ˆ ê°•í™”**: API í‚¤ ê´€ë¦¬, CORS ì„¤ì •
3. **ëª¨ë‹ˆí„°ë§ í™•ì¥**: ì•Œë¦¼, ëŒ€ì‹œë³´ë“œ
4. **CI/CD êµ¬ì¶•**: ìë™ ë°°í¬ íŒŒì´í”„ë¼ì¸

---

**ğŸ“ ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ë¬¸ì œê°€ ìˆìœ¼ë©´ ì–¸ì œë“  ì•Œë ¤ì£¼ì„¸ìš”!** 